<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Address Distance Calculator</title>
    <script type='text/javascript' src='http://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=YOUR_BING_MAPS_API_KEY' async defer></script>
</head>
<body>
    <h1>Address Distance Calculator</h1>
    <form id="addressForm">
        <label for="startAddress">Start Address:</label><br>
        <input type="text" id="startAddress" name="startAddress" required><br><br>
        <label for="endAddress">End Address:</label><br>
        <input type="text" id="endAddress" name="endAddress" required><br><br>
        <button type="button" onclick="calculateDistance()">Calculate Distance</button>
    </form>
    <p id="totalDistance"></p>

    <script>
        let map, searchManager;

        function GetMap() {
            map = new Microsoft.Maps.Map('#map', {
                credentials: 'AtyYPLGNlFzhXhIR_C3dVgmZSGwuxt2E1Z8GyWYWWlTxdaXDRzLEfczs7IT_WRDO'
            });
            Microsoft.Maps.loadModule('Microsoft.Maps.Search', function () {
                searchManager = new Microsoft.Maps.Search.SearchManager(map);
            });
        }

        function calculateDistance() {
            const startAddress = document.getElementById("startAddress").value;
            const endAddress = document.getElementById("endAddress").value;

            searchLocation(startAddress, function (startCoords) {
                searchLocation(endAddress, function (endCoords) {
                    const distance = haversine(startCoords.latitude, startCoords.longitude, endCoords.latitude, endCoords.longitude);
                    document.getElementById("totalDistance").innerHTML = "Total distance: " + distance.toFixed(2) + " miles";
                });
            });
        }

        function searchLocation(query, callback) {
            const searchRequest = {
                query: query,
                count: 1,
                callback: function (results) {
                    if (results && results.results && results.results.length > 0) {
                        const location = results.results[0].location;
                        callback(location);
                    } else {
                        alert('Location not found');
                    }
                },
                errorCallback: function (error) {
                    alert("An error occurred: " + error);
                }
            };

            searchManager.geocode(searchRequest);
        }

        function haversine(lat1, lon1, lat2, lon2) {
            const R = 3958.8; // Earth radius in miles
            const dLat = toRadians(lat2 - lat1);
            const dLon = toRadians(lon2 - lon1);
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        function toRadians(degrees) {
            return degrees * Math.PI / 180;
        }
    </script>

    <div id="map" style="position:relative;width:600px;height:400px;"></div>
</body>
</html>